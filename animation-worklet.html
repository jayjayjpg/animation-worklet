<!DOCTYPE html>
<html>
  <head>
    <title>Animation Worklet</title>
  </head>
  <body>
    <section style="width: 40%; height: 550px; padding: 20px; border: 5px solid #444; margin: 5px; float: left;">
      <div id="square" style="background-color: #dd77dd; width: 50px; height: 50px"></div>
    </section>
    <section style="width: 40%; height: 550px; padding: 20px; border: 5px solid #444; margin: 5px; float: left;">
      <div id="square2" style="background-color: #77dd77; width: 50px; height: 50px"></div>
    </section>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web-animations/2.3.1/web-animations-next.min.js"></script>
    <script>
      function animateIt() {
        const animation = new Animation(
          new KeyframeEffect(
            document.querySelector('#square'),
            [
              {
                transform: 'translateX(0)'
              },
              {
                transform: 'translateX(500px)'
              },
              {
                transform: 'translateY(500px)'
              }
            ],
            {
              delay: 3000,
              duration: 2000,
              iterations: 3
            }
          ),
          document.timeline
        );

        animation.play();
      }

      async function animateWithWorklet(node){
        await CSS.animationWorklet.addModule("animatedscroll.js");

        new WorkletAnimation(
          'animatedscroll',
          new KeyframeEffect(
            node,
            [
              {
                transform: 'translateX(0)'
              },
              {
                transform: 'translateX(500px)'
              }
            ],
            {
              duration: 2000,
              iterations: Number.POSITIVE_INFINITY
            }
          ),
          document.timeline
        ).play();
      }

      document.addEventListener("DOMContentLoaded", function(event) {
        animateIt();
        let node = document.querySelector('#square2');
        if('animationWorklet' in CSS) {
          animateWithWorklet(node);
        } else {
          node.replaceWith('The Animation Worklet API is not supported in your browser.');
        }
      });
    </script>
  </body>
</html>
